<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="c4ndy"><meta name=description content="Real Time web App"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Real Time Web App #1 Bi-directional Communication: Server, The CandyMan"><meta name=twitter:description content="Real Time web App"><meta property="og:title" content="Real Time Web App #1 Bi-directional Communication: Server, The CandyMan"><meta property="og:description" content="Real Time web App"><meta property="og:type" content="article"><meta property="og:url" content="https://c4ndyfl1p.github.io/posts/realtimewebappbidirectioncommunication/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-30T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-30T00:00:00+00:00"><meta property="og:see_also" content="https://c4ndyfl1p.github.io/posts/wiki-reinstallingnextcloud/"><meta property="og:see_also" content="https://c4ndyfl1p.github.io/posts/homelabsetup/"><meta property="og:see_also" content="https://c4ndyfl1p.github.io/posts/wiki-nexcloudmediadirectory/"><meta property="og:see_also" content="https://c4ndyfl1p.github.io/posts/selfhostingandhomelab/"><meta property="og:see_also" content="https://c4ndyfl1p.github.io/posts/meinbrowserland1/"><title>Real Time Web App #1 Bi-directional Communication: Server, The CandyMan · candyForThought</title><link rel=canonical href=https://c4ndyfl1p.github.io/posts/realtimewebappbidirectioncommunication/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=generator content="Hugo 0.102.3"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>candyForThought</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/>Contact me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://c4ndyfl1p.github.io/posts/realtimewebappbidirectioncommunication/>Real Time Web App #1 Bi-directional Communication: Server, The CandyMan</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-03-30T00:00:00Z>March 30, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
6-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/web-development/>web development</a>
<span class=separator>•</span>
<a href=/categories/real-time/>real time</a>
<span class=separator>•</span>
<a href=/categories/django/>django</a>
<span class=separator>•</span>
<a href=/categories/python/>python</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/http/>http</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/web-developement/>web developement</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/web-security/>web-security</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/polling/>polling</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/websockets/>websockets</a></span></div></div></header><div><h1 id=real-time-web-app-1-bi-directional-communication-server-the-candyman>Real Time Web App #1 Bi-directional Communication: Server, The CandyMan
<a class=heading-link href=#real-time-web-app-1-bi-directional-communication-server-the-candyman><i class="fa fa-link" aria-hidden=true></i></a></h1><h4 id=how-do-websites-usually-work>How do websites usually work?
<a class=heading-link href=#how-do-websites-usually-work><i class="fa fa-link" aria-hidden=true></i></a></h4><p>You click something: a button, a link, a hyperlink, a form button i.e you request for a resource from a web-server, in return the website gives you some text, an image, or some other media, more specifically a constructed web document, and a 2xx status code i.e the web-server responds to your request with some resource. Sometimes if that resource is not available it the web server will send a 404 not found response, or if the resource has been moved it will send s 3xx response</p><p>This is achieved through a protocol called HTTP(Hyper text Transfer Protol)</p><p>HTTP is a protocol for fetching resources such as HTML documents. It is the foundation of any data exchange on the Web and it is a client-server protocol, which means requests are initiated by the recipient, usually the Web browser. A complete document is reconstructed from the different sub-documents fetched, for instance, text, layout description, images, videos, scripts, and more.</p><h4 id=a-usual-http-session-looks-like-this>A usual HTTP session looks like this:
<a class=heading-link href=#a-usual-http-session-looks-like-this><i class="fa fa-link" aria-hidden=true></i></a></h4><ol><li>The client establishes a TCP connection (or the appropriate connection if the transport layer is not TCP).</li><li>The client sends its request, and waits for the answer.</li><li>The server processes the request, sending back its answer, providing a status code and appropriate data.</li></ol><p>It would have become evident that HTTP is a client-server protocol i.e A client(usually a web browser) requests for a resource and a web server responds with it. A web server <em>cannot</em> just arbitrarity send out resources to client.</p><h4 id=but-wait-we-are-making-a-real-time-web-app-that-implies-some-thingsanythings-we-dont-have-to-define-things-rn-change-for-one-client-based-on-other-clients-doing-other-things-ie-user-interactions-user-interactions-usually-mean-server-side-events-what-about-them>But wait, we are making a real time web-app, that implies some <em>things</em>(anythings, we dont have to define things rn) change for one client based on other clients doing other <em>things</em> i.e user interactions. User interactions usually mean <strong>Server Side Events</strong>. What about them?
<a class=heading-link href=#but-wait-we-are-making-a-real-time-web-app-that-implies-some-thingsanythings-we-dont-have-to-define-things-rn-change-for-one-client-based-on-other-clients-doing-other-things-ie-user-interactions-user-interactions-usually-mean-server-side-events-what-about-them><i class="fa fa-link" aria-hidden=true></i></a></h4><p>example: a T aims at your head(the exact pixels that make your head at a given time <em>t</em>), shoots their AK, and one tap kills you. Sad life for you :(, but, iff, the server logs you as dead, and then actually tells you &ldquo;hey you got killed, sad life you you :(&rdquo;</p><p>This is an arbitrary response that the server needs to send it, you cannot request for it, neither can you deterministically predict when to ask for it. It&rsquo;s like server needs to be candyman handing out candies(well, death candy in this case)</p><p>There are 2 broad ways to go about it:</p><h1 id=1-polling>1. <strong>Polling:</strong>
<a class=heading-link href=#1-polling><i class="fa fa-link" aria-hidden=true></i></a></h1><p>In the standard HTTP model, a server cannot initiate a connection with a client nor send an unrequested HTTP response to a client; thus, the server cannot push asynchronous events to clients. Therefore, in order to receive asynchronous events as soon as possible, the client needs to poll the server periodically for new content.</p><p>The two most common server-push mechanisms are HTTP long polling and HTTP streaming:</p><ul><li><p>HTTP Long Polling: The server attempts to &ldquo;hold open&rdquo; (not
immediately reply to) each HTTP request, responding only when
there are events to deliver. In this way, there is always a
pending request to which the server can reply for the purpose of
delivering events as they occur, thereby minimizing the latency in
message delivery.</p></li><li><p>HTTP Streaming: The server keeps a request open indefinitely; that
is, it never terminates the request or closes the connection, even
after it pushes data to the client.</p></li></ul><p>(This is framework agnostic, but the following examples will be django-python.)</p><p>There are again, various ways to implement polling in Django, the quickest and cleanest I&rsquo;ve found is this magical library called HTMX(i cannot stress enough of my love for you), other than that, this also let&rsquo;s you get away without writing a shit ton of Javascript (more server side ftw), and let&rsquo;s you add implemt JavaScript functionalities throgh pure HTML attributes. Do check it out!</p><p>Step 1. Include the script source in your HTML template:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;script src=&#34;https://unpkg.com/htmx.org@1.7.0&#34; integrity=&#34;sha384-EzBXYPt0/T6gxNp0nuPtLkmRpmDBbjg6WmCUZRLXBBwYYmwAUxzlSGej0ARHX0Bo&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
</span></span></code></pre></div><p>Step 2:
Add the htmx attribute, point it the URL you want to poll, mention the http method you want to make requests with, put in the poll frequency.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;div hx-get=&#34;/pollingEndpoint/&#34; hx-trigger=&#34;every 2s&#34;&gt;
</span></span></code></pre></div><p>Step 3: make the end point. (views.py in Django)</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>print(randint(1, 100))
</span></span><span style=display:flex><span>def pollingEndpoint(request):
</span></span><span style=display:flex><span>    if request.method == &#34;GET&#34;: 
</span></span><span style=display:flex><span>		rand  = randint(1, 100)
</span></span><span style=display:flex><span>    return HttpResponse(rand)
</span></span></code></pre></div><p>Voila!</p><h1 id=2-web-sockets><strong>2. Web Sockets</strong>
<a class=heading-link href=#2-web-sockets><i class="fa fa-link" aria-hidden=true></i></a></h1><p>So as you can see, creating web applications that need bidirectional communication between a client and a server (e.g., instant messaging and gaming applications) has required an abuse of HTTP to poll the server for updates while sending upstream notifications as distinct HTTP calls [RFC6202]</p><p>Websockets allow you to use a single TCP connection along with a Websocket API to send traffic in both directions. it provides an alternative to HTTP polling for two-way communication from a web page to a remote server. It is designed to work over HTTP ports 80 and 443 as well as to support HTTP proxies and intermediaries, even if this implies some complexity specific to the current environment.</p><ul><li>Websockets can work alongside HTTP. Ideally all synchronous stuff should be over HTTP and asyncronous/user-interactions/server sent events over WebSockets. And they work together!</li><li>The WebSocket Protocol is an independent TCP-based protocol. Its only relationship to HTTP is that its handshake is interpreted by HTTP servers as an Upgrade request. By default, the WebSocket Protocol uses port 80 for regular WebSocket connections and port 443 for WebSocket connections tunneled over
Transport Layer Security (TLS) [RFC2818].</li></ul><p>The protocol has two parts: a handshake and the data transfer</p><p>The handshake from the client looks as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET /chat HTTP/1.1
</span></span><span style=display:flex><span>Host: server.example.com
</span></span><span style=display:flex><span>Upgrade: websocket
</span></span><span style=display:flex><span>Connection: Upgrade
</span></span><span style=display:flex><span>Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
</span></span><span style=display:flex><span>Origin: http://example.com
</span></span><span style=display:flex><span>Sec-WebSocket-Protocol: chat, superchat
</span></span><span style=display:flex><span>Sec-WebSocket-Version: 13
</span></span></code></pre></div><p>The handshake from the server looks as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>HTTP/1.1 101 Switching Protocols
</span></span><span style=display:flex><span>Upgrade: websocket
</span></span><span style=display:flex><span>Connection: Upgrade
</span></span><span style=display:flex><span>Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
</span></span><span style=display:flex><span>Sec-WebSocket-Protocol: chat
</span></span></code></pre></div><p>To use websockets in you django app, you can use channels: <a href=https://channels.readthedocs.io/en/stable/>https://channels.readthedocs.io/en/stable/</a>
It might take a few minutes to an hour to once get started with, once you get it working working with it is essentially the same as working with the MVC paradigm.</p><ul><li>Instead of <strong>view.py</strong>s you have <strong>consumers.py</strong> and you now recieve the power up to write async code iin them.</li><li>For routing we have a <strong>routing.py</strong> instead or <strong>urls.py</strong></li></ul><p>A good resource to check out how to integrate channels is : <a href="https://www.youtube.com/watch?v=R4-XRK6NqMA">https://www.youtube.com/watch?v=R4-XRK6NqMA</a></p><h1 id=thoughts>Thoughts:
<a class=heading-link href=#thoughts><i class="fa fa-link" aria-hidden=true></i></a></h1><p>If you reached here and read through both the examples in this writeup both websockets and polling examples, you would have realised they are doing the same thing: sending a random number to the client. They are just doing it differently.</p><p>This was a simple example(you could argue this this did not require any server side code at all, and you&rsquo;d be be absolutely right in that, but this is an example, replace the random number with some something server generated and that&rsquo;s where the use case lies)</p><p>I personally like websockets. As complexity of your app, and load on the app, increases, polling starts to feel a bit t0o crowd-y.</p><p>Before deciding on what to use take into account pros and cons of both the protocols itselt, but also:</p><ul><li>complexity of your app</li><li>load on the app</li><li>framework (yes. you know why)</li></ul><hr><h6 id=further-readings>Further Readings:
<a class=heading-link href=#further-readings><i class="fa fa-link" aria-hidden=true></i></a></h6><ul><li>A typical HTTP session: <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Session>https://developer.mozilla.org/en-US/docs/Web/HTTP/Session</a></li><li>An Overview of HTTP: <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview>https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview</a></li><li>Known Issues and Best Practices
for the Use of Long Polling and Streaming in Bidirectional HTTP: <a href=https://datatracker.ietf.org/doc/html/rfc6202>https://datatracker.ietf.org/doc/html/rfc6202</a></li><li></li></ul></div><footer><section class=see-also><h3 id=see-also-in-themes-guide>See also in Themes Guide
<a class=heading-link href=#see-also-in-themes-guide><i class="fa fa-link" aria-hidden=true></i></a></h3><nav><ul><li><a href=/posts/wiki-reinstallingnextcloud/>&lt;wiki> | Reinstalling nextcloud</a></li><li><a href=/posts/homelabsetup/>Homelab setup (in progress)</a></li><li><a href=/posts/wiki-nexcloudmediadirectory/>&lt;wiki> | Using and external disk as a data directory for nextcloud</a></li><li><a href=/posts/selfhostingandhomelab/>On selfhosting and Homelab</a></li><li><a href=/posts/meinbrowserland1/>Mein Browserland #1: The web, cookies, authentication</a></li></ul></nav></section></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2022
c4ndy
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>